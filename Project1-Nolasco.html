
<!DOCTYPE html>
<html>
<head>
	<title>Project 1</title>
	<script src="https://d3js.org/d3.v3.min.js"></script>

	<style>

	</style>
</head>
<body>

	<div class="grid-container">

		<div class="header">

				<h2>London's 1854 Cholera Epidemic</h2>
				<h3>Visualization by Krystal Nolasco</h3>

		</div>

		<div class="main">

			<div id="map-div">

				<h3>Map of Outbreak</h3>
				<svg id="map-grid"></svg>

			</div>

			<div id="timeline-div">

				<h3>Timeline of Deaths Per Day</h3>
				<svg id="timeline-grid"></svg>

			</div>

		</div>


	</div>
	<script>

		// DRAWING THE MAP *********************************************************

		// create svg area
    var svg_map = d3.select('#map-grid')
      .attr('width', 420)
      .attr('height', 400);
      //.style('border', 'solid');

		//map scale and offset
		var mapScale = 25,
			mapOffset_X = 475,
			mapOffset_Y = 445;

		//load streets data
    d3.json('streets.json', function (data) {

			//lines
      var linefunc = d3.svg.line()
        .x(function(d) {return (1 - d.x) * mapScale + mapOffset_X})
        .y(function(d) {return (1 - d.y) * mapScale + mapOffset_Y});
        //.interpolate("linear");

      //draw map
      var drawMap = svg_map.selectAll('path')
        .data(data)
        .enter().append('path')
        .style('stroke','black')
        .style('stroke-width', 2)
        .attr('d', linefunc)
        .style('fill', 'none');
    });


		// ADDING PUMPS ************************************************************

		d3.csv('pumps.csv', function (data) {
			//console.log(data);

			var drawPumps = svg_map.selectAll('circle')
				.data(data)
				.enter().append('circle')
				.style('fill', 'black')
				.attr('r', 5)
				.attr('cx', function(d) {return (1 - d.x) * mapScale + mapOffset_X})
				.attr('cy', function(d) {return (1 - d.y) * mapScale + mapOffset_Y})
		});



		// ADDING DEATH LOCATIONS TO MAP *******************************************

		d3.csv('deaths_age_sex.csv', function (data) {
			//console.log(data);

			var drawDeaths = svg_map.selectAll('circle')
				.data(data)
				.enter().append('circle')
				.style('fill', '#8AC926')
				.attr('r', 5)
				.attr('cx', function(d) {return (1 - d.x) * mapScale + mapOffset_X})
				.attr('cy', function(d) {return (1 - d.y) * mapScale + mapOffset_Y})

		});


		// TIMELINE OF DEATHS BAR CHART ********************************************

		//create svg area
		var svg_timeline = d3.select('#timeline-grid')
			.attr('width', 500)
			.attr('height', 500)
			.style('border', 'solid');

			//set bar chart height and width
			/*
			var margin = 200,
					width = svg_timeline.attr('width') - margin,
					height = svg_timeline.attr('height') - margin;
			*/

			var margin = {top: 0, right: 20, bottom: 30, left: 40},
					width = 500 - margin.left - margin.right,
					height = 500 - margin.top - margin.bottom;

			//set bar chart scale
			//var timelineScale_X = d3.scaleBand().range ([0, width]),
				//	timelineScale_Y = d3.scale.linear().range ([height, 0]);
				/*
			var timelineScale_X = d3.time.scale()
					.domain(data.map(function(d) { return d.date;} ))
					//.domain([Date(1854, 8, 1), Date(1854, 9, 30)])
					.range([0, width]),

					timelineScale_Y = d3.scale.linear()
					.range([height, 0]);
					*/



			d3.csv('deathdays.csv', function (data) {
					//console.log(data);
					var timelineScale_X = d3.scale.ordinal()
						.domain(data.map(function(d) {return d.date;}))
						.rangeRoundBands([0, width], .1);
					//timelineScale_Y = d3.scale.linear().domain([0, d3.max(data, function(d) {return d.deaths; })]).range([height, 0]);
					var timelineScale_Y = d3.scale.linear()
						.domain([0, width])
						.range([height - margin.top - margin.bottom, 0]);

					//define scale for x axis
					var x_Scale = d3.time.scale()
						.domain([new Date(1854,8,19), new Date(1854,9,29)])
						.range([0, width]);


					//create axes
					var x_Axis = d3.svg.axis()
						.scale(x_Scale);

					var y_Axis = d3.svg.axis()
						.orient('left')
						.scale(timelineScale_Y);

						svg_timeline.append("g")
							.attr('class', 'x-axis')
							.attr('transform', 'translate(0,' + height + ')')
							.call(x_Axis);

						svg_timeline.append("g")
							.attr('class', 'y-axis')
							.attr('transform', 'rotate(90)')
							.call(y_Axis);





					//bar chart
					var drawTimeline = svg_timeline.selectAll('bar')
						.data(data)
						.enter().append('rect')
						.attr('x', function(d) { return timelineScale_X(d.date); })
						//.attr('y', function(d) { return (height - margin) - (d.deaths * (height - margin) / width) * 8 + 300; })
						.attr('y', function(d) { return (height - margin.top - margin.bottom) - (d.deaths * (height - margin.top - margin.bottom) / width) * 3; })
						.attr('width', timelineScale_X.rangeBand())
						//.attr('height', function(d) {return (height - margin) / width * d.deaths * 8; });
						.attr('height', function(d) {return (height - margin.top - margin.bottom) / width * d.deaths * 3; });



					//var drawTimeline = svg_timeline.selectAll('timeline')
					//.data(data)
			});







	</script>
</body>


</html>
