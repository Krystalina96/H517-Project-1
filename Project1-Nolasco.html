
<!DOCTYPE html>
<html>
<head>
	<title>Project 1</title>
	<script src="https://d3js.org/d3.v3.min.js"></script>

	<link rel="stylesheet" href="style.css">

	<style>
	</style>
</head>
<body>

	<div class="grid-container">

		<div class="header">

				<h2>London's 1854 Cholera Epidemic</h2>
				<h3>Visualization by Krystal Nolasco</h3>

		</div>

		<div class="main">

			<div id="map-div">

				<h3>Map of Outbreak</h3>
				<svg id="map-grid"></svg>

			</div>

			<div id="timeline-div">

				<h3>Timeline of Deaths Per Day</h3>
				<svg id="timeline-grid"></svg>

			</div>

		</div>


	</div>
	<script>

		//set colors
		var colorGreen = '#8AC926',
				colorBlue = '#1982C4';


		// DRAWING THE MAP *********************************************************

		// create svg area
    var svg_map = d3.select('#map-grid')
      .attr('width', 420)
      .attr('height', 400);
      //.style('border', 'solid');

		//map scale and offset
		var mapScale = 25,
			mapOffset_X = 475,
			mapOffset_Y = 445;

		//load streets data
    d3.json('streets.json', function (data) {

			//lines
      var linefunc = d3.svg.line()
        .x(function(d) {return (1 - d.x) * mapScale + mapOffset_X})
        .y(function(d) {return (1 - d.y) * mapScale + mapOffset_Y});
        //.interpolate("linear");

      //draw map
      var drawMap = svg_map.selectAll('path')
        .data(data)
        .enter().append('path')
        .style('stroke','black')
        .style('stroke-width', 2)
        .attr('d', linefunc)
        .style('fill', 'none');
    });


		// ADDING PUMPS ************************************************************

		d3.csv('pumps.csv', function (data) {
			//console.log(data);

			var drawPumps = svg_map.selectAll('circle')
				.data(data)
				.enter().append('circle')
				.style('fill', 'black')
				.attr('r', 5)
				.attr('cx', function(d) {return (1 - d.x) * mapScale + mapOffset_X})
				.attr('cy', function(d) {return (1 - d.y) * mapScale + mapOffset_Y})
		});



		// ADDING DEATH LOCATIONS TO MAP *******************************************

		//add a date to the death_age_sex file
		d3.csv('deathdays.csv', function(deathdays) {

			d3.csv('deaths_age_sex.csv', function (deathlocations) {

				//console.log(deathdays);
				//console.log(deathlocations);
				var p = 0; // person in deathlocations

				for(i = 0; i < deathdays.length; i++) {
					//grab date & number of deaths
					var deathDate = deathdays[i].date,
							dailyDeaths = deathdays[i].deaths;
							//console.log(deathDate + " " + dailyDeaths);

					//add the date to deaths_age_sex
					for(j = 0; j < dailyDeaths; j++) {
						deathlocations[p].date = deathDate;
						p++; // go to the next person in deathlocations

						//console.log(p + " " + deathDate);
					}
				};

				//draw death circles on the map
				var drawDeaths = svg_map.selectAll('circle')
					.data(deathlocations)
					.enter().append('circle')
					.style('fill', colorGreen)
					.attr('r', 5)
					.attr('cx', function(d) {return (1 - d.x) * mapScale + mapOffset_X})
					.attr('cy', function(d) {return (1 - d.y) * mapScale + mapOffset_Y})
					//.attr('id', function(d) {return 'deaths' + d.id; })
					.attr('class', function(d) {console.log ('death' + d.date); return 'death' + d.date; });

			});
		})




		// TIMELINE OF DEATHS BAR CHART ********************************************

			var margin = {top: 0, right: 20, bottom: 30, left: 60},
					width = 500 - margin.left - margin.right,
					height = 500 - margin.top - margin.bottom;

			//create svg area
			var svg_timeline = d3.select('#timeline-grid')
				.attr('width', width + margin.left + margin.right)
				.attr('height', height + margin.top + margin.bottom);
				//.style('border', 'solid');

			d3.csv('deathdays.csv', function (data) {
					//console.log(data);
					var timelineScale_X = d3.scale.ordinal()
						.domain(data.map(function(d) {return d.date;}))
						.rangeRoundBands([0, width], .1);

					var timelineScale_Y = d3.scale.linear()
						.domain([0, 150])
						.range([height, 0]);

					//define scale for x axis
					var x_Scale = d3.time.scale()
						.domain([new Date(1854,8,19), new Date(1854,9,29)])
						.range([0, width]);

					//create axes
					var x_Axis = d3.svg.axis()
						.scale(x_Scale);

					var y_Axis = d3.svg.axis()
						.orient('left')
						.scale(timelineScale_Y);
						//.ticks(7);
						//.ticks(10);

					svg_timeline.append("g")
						.attr('class', 'x-axis')
						.attr('transform', 'translate(' + margin.left + ',' + height +')')
						.call(x_Axis);

					svg_timeline.append("g")
						.attr('class', 'y-axis')
						.attr('transform', 'translate(' + margin.left + ',0)')
						.call(y_Axis);

					//y axis text label
					svg_timeline.append('text')
						.attr('class', 'y-axis-label')
						.attr('text-anchor', 'middle')
						.attr('y', 55)
						//.attr('x', height / 2 - 60)
						.attr('x', height / 2)
						.attr('transform', 'translate(' + margin.left + ')')
						.attr('transform', function(d) {
							return 'translate(' + margin.left + ') rotate(90)'
						})
						.text('Number of Deaths');


					//bar chart
					var drawTimeline = svg_timeline.selectAll('bar')
						.data(data)
						.enter().append('rect')
						.attr('x', function(d) { return margin.left + timelineScale_X(d.date); })
						.attr('y', function(d) { return timelineScale_Y(d.deaths); })
						.attr('width', timelineScale_X.rangeBand())
						.attr('height', function(d) { return height - timelineScale_Y(d.deaths)})
						.on('mouseover', function(d) {
							d3.select(this)
								.style('fill', colorBlue);

							d3.selectAll('.' + 'death' + d.date)
								.style('fill', colorBlue)
								.attr('r', '8');
						})
						.on('mouseout', function(d) {
							d3.select(this)
							.style('fill', 'black');

							d3.selectAll('.' + 'death' + d.date)
								.style('fill', colorGreen)
								.attr('r', '5');


						})
			});







	</script>
</body>


</html>
